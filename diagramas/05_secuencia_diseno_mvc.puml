@startuml
skinparam backgroundColor #FEFEFE
skinparam defaultFontSize 11
skinparam sequenceMessageFontSize 11
skinparam sequenceParticipantFontSize 11
skinparam sequenceArrowThickness 2
skinparam responseMessageBelowArrow true
skinparam maxMessageSize 250

skinparam participant {
    BackgroundColor #FFFFFF
    BorderColor #333333
}

title Diagrama de Secuencia de Diseño (MVC)\nFlujo Básico - Generar Constancia

actor "Personal\nAdministrativo" as Actor

participant "Main" as Main #F3E5F5
participant "VentanaConstancia\n[Vista]" as Vista #BBDEFB
participant "ControladorConstancia\n[Controlador]" as Ctrl #FFF9C4
participant "DatosAlumnos\n[Modelo]" as Datos #C8E6C9
participant "Alumno\n[Modelo]" as Alumno #C8E6C9
participant "Materia\n[Modelo]" as Materia #C8E6C9

== 1. Inicialización del Sistema ==
Actor -> Main : Ejecuta la aplicación
activate Main
Main -> Main : UIManager.setLookAndFeel()
Main -> Vista : new VentanaConstancia()
activate Vista
Vista -> Vista : initComponents()
note right : Crea JTextField, JList,\nJTextArea, JButton,\nJScrollPanes y layout\ncon BorderLayout
Vista --> Main : vista creada
Main -> Ctrl : new ControladorConstancia(vista)
activate Ctrl
Ctrl -> Datos : obtenerAlumnos()
activate Datos
Datos -> Alumno : new Alumno("000123456", ...)
activate Alumno
Alumno -> Materia : new Materia("ISW-401", ...)
activate Materia
Materia --> Alumno : materia
deactivate Materia
Alumno --> Datos : alumno con materias
deactivate Alumno
note right of Datos : Crea 8 alumnos\ncon sus materias
Datos --> Ctrl : ArrayList<Alumno> (8 alumnos)
deactivate Datos
Ctrl -> Ctrl : configurarEventos()
note right : Registra:\n- DocumentListener en txtId\n- ListSelectionListener en listaAlumnos\n- ActionListener en btnGenerar
Ctrl --> Main : controlador listo
Main -> Vista : setVisible(true)
deactivate Ctrl
deactivate Main

== 2. Búsqueda Incremental por ID ==
Actor -> Vista : Escribe "000123" en txtId
Vista -> Ctrl : DocumentListener\ninsertUpdate(DocumentEvent)
activate Ctrl
Ctrl -> Vista : getTxtId().getText()
Vista --> Ctrl : "000123"
Ctrl -> Datos : filtrarAlumnos("000123")
activate Datos
Datos -> Datos : alumnosFiltrados.clear()

loop por cada alumno en todosLosAlumnos
    Datos -> Alumno : getId()
    Alumno --> Datos : "000123456"
    Datos -> Datos : "000123456".contains("000123") → true
    Datos -> Datos : alumnosFiltrados.add(alumno)
end

Datos -> Datos : notificarObservadores()
Datos -> Vista : <<IAlumnoObserver>>\nactualizarListaAlumnos(alumnosFiltrados)
activate Vista
Vista -> Vista : modeloLista.clear()
loop por cada alumno filtrado
    Vista -> Vista : modeloLista.addElement(...)
end
Vista --> Datos
deactivate Vista
Datos --> Ctrl
deactivate Datos
note right : Resultado: Se actualiza la\nlista pasivamente (Observer)
deactivate Ctrl

== 3. Selección de Alumno ==
Actor -> Vista : Selecciona primer alumno de la lista
Vista -> Ctrl : ListSelectionListener\nvalueChanged(ListSelectionEvent)
activate Ctrl
Ctrl -> Vista : getListaAlumnos().getSelectedIndex()
Vista --> Ctrl : 0
Ctrl -> Datos : seleccionarAlumno(0)
activate Datos
Datos -> Datos : alumnoSeleccionado =\nalumnosFiltrados.get(0)

Datos -> Datos : notificarObservadores()
Datos -> Vista : <<IAlumnoObserver>>\nactualizarDatosAlumno(alumnoSeleccionado)
activate Vista
group Construir datos de confirmación
    Vista -> Alumno : getId(), getNombreCompleto()...
    Alumno --> Vista : datos
    Vista -> Vista : txtInfo.setText(datos formateados)
    Vista -> Vista : btnGenerar.setEnabled(true)
end
Vista --> Datos
deactivate Vista
Datos --> Ctrl
deactivate Datos
deactivate Ctrl

== 4. Generación de Constancia ==
Actor -> Vista : Clic en botón "Generar Constancia"
Vista -> Ctrl : ActionListener\nactionPerformed(ActionEvent)
activate Ctrl
Ctrl -> Datos : getAlumnoSeleccionado()
Datos --> Ctrl : alumnoSeleccionado
Ctrl -> Vista : renderizarVistaConstancia(alumnoSeleccionado)
activate Vista
group Construir constancia formal
    Vista -> Vista : SimpleDateFormat.format(new Date())
    Vista -> Alumno : getNombreCompleto(), getId()...
    Alumno --> Vista : datos completos
    
    loop por cada materia
        Vista -> Materia : getClave(), getNombre(), getCreditos()
        Materia --> Vista : datos materia
    end
    
    Vista -> Vista : txtInfo.setText(constancia completa)
end
Vista --> Ctrl
deactivate Vista
deactivate Ctrl

Actor <-- Vista : Se muestra la constancia\noficial en pantalla
deactivate Vista
@enduml
